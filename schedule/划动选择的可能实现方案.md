# 划动选择的可能实现方案

by Jerry

以下讨论：当鼠标在显示着 PDF 页面的区域划动（即拖动）时，选择划中内容的方案。

> [!CAUTION]
>
> 以下讨论限定在单页视图。连续视图涉及跨页面的选择，需另作讨论。

触发事件：鼠标拖动，需绑定到 `current_tab.canvas` 上。

记鼠标拖动的起点为 $(x_{m 0}, y_{m 0})$ ，终点为 $(x_{m 1}, y_{m 1})$ 。

1. 得到 `curent_page` 上的所有文字对象。

2. 判断 $(x_{0}, y_{0})$ 有没有落在某个文字的矩形框里。如果有，则是划字，记该字为 `char_0` 。如果没有，则是拖动页面。下面讨论划字的情况。

3. 判断一行的范围：将文字按照 x 坐标升序排序，从 `char_0` 开始向高处遍历，若遇到某个文字 `char_i` 满足
    $$
    y_l < y_{i h} \text{ 且 } y_{i l} < y_h
    $$
    （其中 $y_l$ 是这一行的下边界的 y 坐标， $y_{h}$ 是这一行的上边界的 y 坐标， $y_{i l}$ 是 `char_i` 的下边界的 y 坐标， $y_{i h}$ 是 `char_i` 的上边界的 y 坐标），则认为 `char_i` 是这一行的，将 `char_i` 添加到这行里。

    行的下边界定义为这行中所有文字的最小下边界；行的上边界定义为这行中所有文字的最大上边界。

    当一行的文字找完了之后，再找 y 坐标小于上一行下边界的最高文字，将其纳入下一行，然后再次遍历所有文字对象，查找同一行的文字。

4. 重复步骤3，直到 $y_{m 1}$ 高于当前行的下边界。

5. 选中的文字为：第一行的、中间行的所有、最后一行的部分（可能为空）。

6. 给被选中的每一行绘制一个半透明的长矩形，浮于文字上方，表示这些文字被选中了。

> [!NOTE]
>
> 步骤3是我瞎想的，希望大家能提出更好的方案！

